```
#include "simple_memory_manager.h"
#include "app_zlib.h"

#define HZW_BUF_POOL_SIZE (100 * 1024)

STSMM smm = {0};

void* hzwMalloc(void *opaque, unsigned int items, unsigned int size) {
	return smmMallocAligned(&smm, items * size, 4);
}

void hzwFree(void *opaque, void *address) {
}

void test() {
	char gzipped[] = {
		0x1f, 0x8b, 0x08, 0x18, 0x80, 0x89, 0xb7, 0x20, 0x00, 0xff,
		0x61, 0x2d, 0x6e, 0x65, 0x77, 0x2d, 0x68, 0x6f, 0x70, 0x65,
		0x2e, 0x74, 0x78, 0x74, 0x00, 0x61, 0x6e, 0x20, 0x65, 0x70,
		0x69, 0x63, 0x20, 0x73, 0x70, 0x61, 0x63, 0x65, 0x20, 0x6f,
		0x70, 0x65, 0x72, 0x61, 0x20, 0x62, 0x79, 0x20, 0x47, 0x6f,
		0x72, 0x67, 0x65, 0x20, 0x4c, 0x75, 0x63, 0x61, 0x73, 0x00,
		0x72, 0x54, 0xc8, 0xc9, 0xcf, 0x4b, 0x57, 0x28, 0xc9, 0xcc,
		0x4d, 0x55, 0x48, 0x4c, 0xcf, 0x57, 0xc8, 0xcc, 0x53, 0x48,
		0x54, 0x48, 0x4f, 0xcc, 0x49, 0xac, 0xa8, 0x54, 0x48, 0x4b,
		0x2c, 0xd2, 0x01, 0x11, 0x0a, 0x89, 0xe5, 0x89, 0x95, 0x7a,
		0x7a, 0x7a, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0x10, 0x8a,
		0xa3, 0xef, 0x2c, 0x00, 0x00, 0x00,
	};
	char *buf = NULL;
	int len = 0;

	void *buf_pool = NULL;

	gzFile file = NULL;
	gz_stream stream = {0};
	int result = 0;

	len = *(gzipped + sizeof(gzipped) - 4);
	buf = applib_asm_alloc_anonymous(len);
	if (!buf) {
		goto end;
	}

	buf_pool = applib_asm_alloc_anonymous(HZW_BUF_POOL_SIZE);
	if (!buf_pool) {
		goto end;
	}
	smmInit(&smm, buf_pool, HZW_BUF_POOL_SIZE);

	file = appzlib_gzopen_mem(&stream, gzipped, sizeof(gzipped), "rb", hzwMalloc, hzwFree);
	if (!file) {
		goto end;
	}
	result = appzlib_gzread(file, buf, len);
	if (result <= 0) {
		goto end;
	}

end:
	if (file) {
		appzlib_gzclose(file);
	}

	if (buf) {
		applib_asm_free_anonymous(buf);
	}

	if (buf_pool) {
		applib_asm_free_anonymous(buf_pool);
	}
}
```
